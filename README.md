# ç„¡shinsa
## ğŸ› ï¸ Tools : <img src="https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white"> <img src="https://img.shields.io/badge/spring-6DB33F?style=for-the-badge&logo=github&logoColor=Green"> <img alt="Java" src ="https://img.shields.io/badge/Java-007396.svg?&style=for-the-badge&logo=Java&logoColor=white"/>  <img alt="Java" src ="https://img.shields.io/badge/intellijidea-000000.svg?&style=for-the-badge&logo=intellijidea&logoColor=white"/>, <img src="https://img.shields.io/badge/AmazonAWS-FF0000?style=flat-square&logo=Adobe&logoColor=white">
## ğŸš© Period : 2024/01/02 ~ 2024/02/10
## ğŸ‘¨â€ğŸ’» ERD <a=href>https://www.erdcloud.com/d/vHWtykYujZaDJdLpc</a=href>
## ğŸ‘¨â€ğŸ’» API
<a=href>https://identity.getpostman.com/handover/multifactor?user=41769599&handover_token=3a869f52-d810-4426-b93a-9e4ae97357cd</a=href>
## ğŸ‘¨â€ğŸ’» Role 
ì´í•´ìš± : Order, Toss  
ê¶Œì§„ì„ : Category, Brand 
ê¹€ë¯¼ê²½ : User, í†µê³„ 
í™©ìƒìµ : Image, Report, Product, ProductOptions, CartItem, Coupon, Review, Cateogry Refactoring, Brand Refactoring, AWS, Order ì¼ë¶€ Refactoring, ê° ê¸°ëŠ¥ ë™ì  ì¿¼ë¦¬ ì‘ì„± 
## ğŸ‘¨â€ğŸ’» About Project 
- ì¿ íŒ¡, ë¬´ì‹ ì‚¬ ì´ì»¤ë¨¸ìŠ¤ë¥¼ ëª¨í‹°ë¸Œë¡œ ç„¡ì‹ ì‚¬ë¼ëŠ” ì‡¼í•‘ëª° ì´ì»¤ë¨¸ìŠ¤ ì…ë‹ˆë‹¤. íšŒì›ê°€ì…ê³¼ ë°± ì˜¤í”¼ìŠ¤ ê¸°ëŠ¥ì´ ê°–ì¶°ì ¸ ìˆê³ , íšŒì›ë³„ ë“±ê¸‰ì— ë”°ë¼ ìƒí’ˆ ì ë¦½ í¬ì¸íŠ¸ê°€ ì ë¦½ì´ ë˜ì–´ ê·¸ì— ë§ëŠ” í• ì¸ ë° í¬ì¸íŠ¸ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ê²Œ í•  ìˆ˜ ìˆìœ¼ë©°, ê´€ë¦¬ìì™€ ì ì£¼ëŠ” íŒë§¤ í˜„í™© ë° ìì‹ ì˜ ë§¤ì¥ì˜ ë§¤ì¶œ í˜„í™©ì„ ë¶„ì„í•´, ë³´ë‹¤ ì˜ì—…ì„ íš¨ìœ¨ì ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ì†Œë¹„ìëŠ” ë¸Œëœë“œë³„ ì¹´í…Œê³ ë¦¬ì— ìƒí’ˆë“¤ì´ êµ¬ì„±ë˜ì–´ êµ¬ë§¤ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë˜í•œ ì¿ í° ì§€ê¸‰ì„ í†µí•´ ì†Œë¹„ìëŠ” ìƒí’ˆì„ êµ¬ë§¤í•  ë•Œ ë³´ë‹¤ í• ì¸ë˜ì–´ ìˆëŠ” ìƒí’ˆì„ í†µí•´ êµ¬ë§¤ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. ìƒí’ˆ êµ¬ë§¤ í›„ í›„ê¸° ì‘ì„±ì´ ê°€ëŠ¥ í•˜ë©°, ìƒí’ˆ êµ¬ë§¤ ì§ì „ ë‹¤ë¥¸ ì‚¬ëŒì˜ í›„ê¸°ê°€ ê¶ê¸ˆí•  ê²½ìš°, ë³„ì ì— ë”°ë¼ ì¡°íšŒê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
ì•…ì„± ë¦¬ë·°ë‚˜, ì˜ëª»ëœ ìƒí’ˆì´ ìˆì„ ê²½ìš°ì—ëŠ” ì‹ ê³ ê¸°ëŠ¥ì„ í†µí•´, í•´ë‹¹ ê°œì‹œë¬¼ í˜¹ì€ ìƒí’ˆì„ ì‹ ê³  í•  ìˆ˜ ìˆìœ¼ë©°, ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ë©´, Admin ì¸¡ì—ì„œ ì ì ˆí•œ ì¡°ì¹˜ê°€ ì´ë¤„ì§ˆ ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤. 
## MVP 1 
- User  
  - UserService
    - CRUD : íšŒì› ê°€ì…, ë¡œê·¸ì¸, íšŒì› ì¡°íšŒ, íšŒì› ìˆ˜ì •, ë¡œê·¸ì´ì›ƒ ê¸°ëŠ¥
  - UserController
    - UserServiceì— íšŒì› ê°€ì…, ë¡œê·¸ì¸, íšŒì› ì¡°íšŒ, íšŒì› ìˆ˜ì •, ë¡œê·¸ì´ì›ƒê¸°ëŠ¥ í˜¸ì¶œ
- Brand
  - BrandService
    -  CRUD : ë¸Œëœë“œ ìƒì„±, ìˆ˜ì •, ì¡°íšŒ, ë¸Œëœë“œë³„ ì ì£¼ ì¡°íšŒ, ëª¨ë“  ë¸Œëœë“œ ì¡°íšŒ
  - BrandController
    - BrandServiceì— ë¸Œëœë“œ ìƒì„±, ìˆ˜ì •, ì¡°íšŒ, ë¸Œëœë“œë³„ ì ì£¼ ì¡°íšŒ, ëª¨ë“  ë¸Œëœë“œ ì¡°íšŒ ê¸°ëŠ¥ í˜¸ì¶œ
- Category
  - CategoryService
    - CRUD : ì¹´í…Œê³ ë¦¬ ìƒì„±, ì¡°íšŒ , ìˆ˜ì • ê¸°ëŠ¥
  - CateogryController
    - CategoryServiceì— ì¹´í…Œê³ ë¦¬ ìƒì„±, ì¡°íšŒ , ìˆ˜ì • ê¸°ëŠ¥ í˜¸ì¶œ
- CartItem
  - CartItemService
    - CRUD : ì¥ë°”êµ¬ë‹ˆ ìƒì„±, ì¥ë°”êµ¬ë‹ˆ ì „ì²´ ì¡°íšŒ (ë‚ ì§œ ì„ íƒ ì¡°íšŒ), ì¥ë°”êµ¬ë‹ˆ ìˆ˜ì •, ì¥ë°”êµ¬ë‹ˆì—ì„œ êµ¬ë§¤ ì „ ì¿ í°ì´ ìˆë‹¤ë©´ ì¿ í° ì ìš©
  - CartItemController
    - ì¥ë°”êµ¬ë‹ˆ ìƒì„±, ì¥ë°”êµ¬ë‹ˆ ì „ì²´ ì¡°íšŒ (ë‚ ì§œ ì„ íƒ ì¡°íšŒ), ì¥ë°”êµ¬ë‹ˆ ìˆ˜ì •, ì¥ë°”êµ¬ë‹ˆì—ì„œ êµ¬ë§¤ ì „ ì¿ í°ì´ ìˆë‹¤ë©´ ì¿ í° ì ìš© ê¸°ëŠ¥ í˜¸ì¶œ
- Product
  - ProductService
    - CRUD : ìƒí’ˆ ìƒì„±, ìˆ˜ì •, ë‹¨ì¼ ìƒí’ˆ ì¡°íšŒ, ì´ë¦„ ë‚´ë¦¼ì°¨ìˆœ ìƒí’ˆ ì¡°íšŒ, ìƒí’ˆ ì‚­ì œ
  - ProductController
    - ìƒí’ˆ ìƒì„±, ìˆ˜ì •, ë‹¨ì¼ ìƒí’ˆ ì¡°íšŒ, ì´ë¦„ ë‚´ë¦¼ì°¨ìˆœ ìƒí’ˆ ì¡°íšŒ, ìƒí’ˆ ì‚­ì œ ê¸°ëŠ¥ í˜¸ì¶œ 
- Review
  - ReviewService
    - CRUD : ë¦¬ë·° ìƒì„±, ë¦¬ë·° ì¡°íšŒ, ë¦¬ë·° ìˆ˜ì •, ë¦¬ë·° ë³„ì ì— ë”°ë¼ ì¡°íšŒ ê¸°ëŠ¥, ë¦¬ë·° ì‚­ì œ
  - ReviewController
    - ë¦¬ë·° ìƒì„±, ë¦¬ë·° ì¡°íšŒ, ë¦¬ë·° ìˆ˜ì •, ë¦¬ë·° ë³„ì ì— ë”°ë¼ ì¡°íšŒ ê¸°ëŠ¥, ë¦¬ë·° ì‚­ì œ í˜¸ì¶œ
- Report
  - ReportService
    - CRUD : ì‹ ê³  ìƒì„±, ì‹ ê³  ìƒíƒœ ë³€ê²½, ì‹ ê³  ì¡°íšŒ, ëª¨ë“  ì‹ ê³  ì¡°íšŒ, ì‹ ê³  ì‚­ì œ
  - ReviewController
    - ì‹ ê³  ìƒì„±, ì‹ ê³  ìƒíƒœ ë³€ê²½, ì‹ ê³  ì¡°íšŒ, ëª¨ë“  ì‹ ê³  ì¡°íšŒ, ì‹ ê³  ì‚­ì œ í˜¸ì¶œ
- Coupon
  - CouponService
    - ì¿ í° ìƒì„±, ì¿ í° ìƒì„±ì‹œ ë¶„ì‚°ë½ì„ í™œìš©í•´, ë™ì‹œì„± ì œì–´ë¥¼ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.
      ë¹„ê´€ì  ë½, ë‚™ê´€ì  ë½ì„ ì‚¬ìš©í•˜ë©´ ë™ì‹œì„±ì— ë¬¸ì œëŠ” í•´ê²°ë˜ì§€ë§Œ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥ì„±, íŠ¹íˆ íŠ¸ëœì­ì…˜ì´ ë§ì´ì§ˆìˆ˜ë¡ DBì— ë½ì´ ì¦ê°€í•˜ì—¬ ì„±ëŠ¥ì´ ë–¨ì–´ì§€ê±°ë‚˜ ë°ë“œë½ ë°œìƒ ê°€ëŠ¥ì„± ì¦ê°€. ì´ë¥¼ í•´ë ¥í•˜ê¸° ìœ„í•´ Redissonê³¼ ê°™ì€ In-Memory ë°ì´í„° ì €ì¥ì†Œë¥¼ í™œìš©í•œ ë¶„ì‚° ë½ì„ ì ìš©í•˜ë©´, ë¹ ë¥¸ ì†ë„ë¡œ ë™ì‹œì„±ì„ ì œì–´í•˜ë©´ì„œ ì„±ëŠ¥ ì €í•˜ ì—†ì´ ì¿ í° ë°œê¸‰ì„ ì²˜ë¦¬ê°€ ê°€ëŠ¥ í•˜ê³   In-Memory ë°ì´í„° ì €ì¥ì†Œë¥¼ í™œìš©í•œ ë¶„ì‚° ë½ì„ ì ìš©í•˜ë©´, ë¹ ë¥¸ ì†ë„ë¡œ ë™ì‹œì„±ì„ ì œì–´í•˜ë©´ì„œ ì„±ëŠ¥ ì €í•˜ ì—†ì´ ì¿ í° ë°œê¸‰ì„ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤. 
  - CouponContoller
    - ì¿ í°ì„ ìƒì„±í•˜ëŠ”ë° í˜¸ì¶œ
- Static
  - StaticService
    - í˜„ì¬ ë§¤ì¶œ ìƒíƒœë¥¼ í™•ì¸, í†µê³„ í•©ê³„
  - StaticController
    - StaticService í˜¸ì¶œ

## ğŸ§¨ TroubleShooting 
- QeuryDsl TroubleShooting
  - ë™ì  ì¿¼ë¦¬ ì‘ì„±ì‹œ, ì²˜ìŒì— Serviceì— ì¡°íšŒ ê¸°ëŠ¥ì— ë™ì ì¿¼ë¦¬ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ë ‡ê²Œ ì‘ì„±í•  ê²½ìš° Serviceì— Repositoryì— ì±…ì„ì´ ì „ê°€ë˜ì–´
    ì±…ì„ì´ ë¶ˆëª…í™•í•´ ì§€ëŠ” í˜„ìƒì´ ë°œìƒí•´, CustomRepositoryë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ ë™ì  ì¿¼ë¦¬ ë¶€ë¶„ë§Œ ë”°ë¡œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤
  - Entityë¡œ Parsingì„ ë°›ì•„ ì‘ì„±í–ˆëŠ”ë° Entityë¡œ ë°›ì•„ ì˜¤ê²Œ ë˜ë©´ ë¶ˆí•„ìš”í•œ ì»¬ëŸ¼ê¹Œì§€ ì¡°íšŒí•˜ê²Œ ë˜ëŠ” í˜„ìƒì´ ìˆê³ , ë ˆì´ì–´ êµ¬ì¡° ìœ ì§€ë¥¼ í•˜ê¸°ì— ì–´ë ¤ì›€ì´ ìˆì–´ Projections.constructor(dto.class)ë¼ëŠ” ê°’ìœ¼ë¡œ ë°›ë„ë¡ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.
  - Dto í•„ë“œ ìˆœì„œì— ë§ê²Œ ì‘ì„±í•´ì•¼ í•˜ëŠ”ë° ìˆœì„œì— ë§ê²Œ, í˜¹ì€ dto ê°’ì— ì—†ì„ ê²½ìš° 
```
com.querydsl.core.types.ExpressionException: No constructor found for class com.Soo_Shinsa.order.dto.OrderItemResponseDto with parameters: [class java.lang.Long, class java.lang.Integer, class java.lang.Long, class java.lang.String, class java.math.BigDecimal, class java.lang.Long]
```       
ë¼ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•´, dto ìˆœì„œì— ë§ê²Œ í•„ë“œê°’ì„ í•˜ë‚˜í•˜ë‚˜ ë‹¤ì‹œ í™•ì¸í•´ ìˆ˜ì • í–ˆìŠµë‹ˆë‹¤. 

- Coupon
  - CouponTest ë„ì¤‘ DeadLock ë°œìƒ
   - í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ë™ì‹œì— 4000ê°œì˜ ìš”ì²­ì´ ì¿ í° ë°œê¸‰ì„ ì‹œë„, ì¿ í° ë°œê¸‰ ê°œìˆ˜ëŠ” 10ê°œë¡œ ì œí•œ, ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ê°™ì€ ì¿ í°ì„ ê°€ì ¸ì™€ ë°œê¸‰í•˜ë ¤ê³  í•˜ë©´ ê²½í•© ìƒíƒœ ë°œìƒ, issuedCount(ë°œê¸‰ëœ ê°œìˆ˜)ë¥¼ ì²´í¬í•˜ê³  ì¦ê°€ì‹œí‚¤ëŠ” ë¡œì§ì´ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬ë˜ì§€ ì•Šìœ¼ë©´, ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ê°™ì€ ì¿ í°ì„ ë°œê¸‰í•˜ë ¤ê³  ê²½ìŸí•˜ì—¬ ë°ì´í„° ì •í•©ì„±ì´ ê¹¨ì§ˆ ìˆ˜ ìˆìŒ. ê·¸ë˜ì„œ ë¹„ê´€ì  ë½ì„ ì‚¬ìš©í•´ íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œë  ë•Œ ê¹Œì§€ íŠ¹ì • ë°ì´í„° ë³€ê²½ì„ ì°¨ë‹¨.
  - ì¿ í° ì œê³  ë¬¸ì œ
   - ì¿ í°ì„ ì‚¬ìš©í•˜ë©´ ìˆ˜ëŸ‰ì€ ê°ì†Œë˜ì—ˆì§€ë§Œ, ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ë™ì¼í•œ ì¿ í°ì„ ì‚¬ìš©í•˜ë ¤ê³  í•˜ë©´ `NOT_FOUND_COUPON` ì˜ˆì™¸ê°€ ë°œìƒí•¨
     ê¸°ì¡´ ì½”ë“œì—ì„œ `findUnusedCouponByCouponId(requestDto.getCouponId())`ë¡œ ì¡°íšŒí•  ë•Œ, íŠ¹ì • ì‚¬ìš©ìì˜ `CouponUser`ë§Œ ì¡°íšŒ í–ˆìŒ
     ì¦‰, ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì ‘ê·¼í•  ê²½ìš° ìƒˆë¡œìš´ ì¿ í°ì„ ì°¾ì§€ ëª»í•¨. ì¿ í°ì˜ ì¬ê³ (`maxCount`)ê°€ ë‚¨ì•„ ìˆì–´ë„, ìƒˆë¡œìš´ `CouponUser`ê°€ ìƒì„±ë˜ì§€ ì•Šì•„ì„œ ë°œìƒí•œ ë¬¸ì œ.
     ì¬ê³ (`maxCount`)ê°€ ë‚¨ì•„ ìˆë‹¤ë©´ ìƒˆë¡œìš´ `CouponUser`ë¥¼ ìƒì„±í•˜ë„ë¡ ìˆ˜ì •, ê¸°ì¡´ `findUnusedCouponByCouponId()`ì—ì„œ ì¿ í°ì´ ì—†ì„ ê²½ìš°, couponRepository.findById() ë¥¼ í†µí•´ ì¿ í°ì„ ì¡°íšŒí•˜ê³  ìƒˆë¡œìš´ `CouponUser`ë¥¼ ìƒì„± í›„ ì €ì¥í•˜ì—¬ ë‹¤ë¥¸ ì‚¬ìš©ìë„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë³€ê²½
ğŸ‘ ìµœì¢… ì ìš©í•œ ì½”ë“œ 
```
@Transactional
public ApplyCouponCartResponseDto applyCoupon(Long cartId, ApplyCouponCartRequestDto requestDto, User user) {
    CartItem cartItem = cartItemRepository.findByIdOrElseThrow(cartId);

    String lockKey = "coupon-lock:" + requestDto.getCouponId();
    RLock lock = redissonClient.getLock(lockKey);

    try {
        if (!lock.tryLock(5, 10, TimeUnit.SECONDS)) {
            throw new IllegalStateException("í˜„ì¬ ì¿ í° ì‚¬ìš© ìš”ì²­ì´ ë§ì•„ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
        }

        Optional<CouponUser> optionalCouponUser = couponUserRepository.findUnusedCouponByCouponId(requestDto.getCouponId());

        Coupon coupon;
        CouponUser couponUser;

        if (optionalCouponUser.isPresent()) {
            couponUser = optionalCouponUser.get();
            coupon = couponUser.getCoupon();
        } else {
            coupon = couponRepository.findById(requestDto.getCouponId())
                    .orElseThrow(() -> new InvalidInputException(ErrorCode.NOT_FOUND_COUPON));

            if (coupon.getMaxCount() <= 0) {
                throw new InvalidInputException(ErrorCode.COUPON_OUT_OF_STOCK);
            }

            couponUser = CouponUser.builder()
                    .coupon(coupon)
                    .user(user)
                    .isUsed(false)
                    .usedAt(null)
                    .build();

            couponUserRepository.save(couponUser);
        }

        if (coupon.isExpired()) {
            throw new InvalidInputException(ErrorCode.EXPIRED_COUPON);
        }

        DiscountCouponCalculator discountCouponCalculator = new PercentageDiscountCalculator();
        BigDecimal discountPrice = discountCouponCalculator.calculateDiscountedPrice(cartItem.getProduct().getPrice(), coupon.getDiscountRate());

        cartItem.applyCoupon(coupon, discountPrice);
        cartItemRepository.save(cartItem);

        couponUser.markAsUsed();
        coupon.decreaseMaxCount(1);
        couponUserRepository.save(couponUser);

        List<ProductOption> productOptions = productOptionRepository.findProductOptionByProductId(cartItem.getProduct().getId());
        return ApplyCouponCartResponseDto.toDto(cartItem, productOptions);

    } catch (InterruptedException e) {
        Thread.currentThread().interrupt();
        throw new IllegalStateException("ì¿ í° ì ìš© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", e);
    } finally {
        if (lock.isHeldByCurrentThread()) {
            lock.unlock();
        }
    }
}
```

- Product
 - ìƒí’ˆ ì¡°íšŒ ì‹œ íŒŒë¼ë¯¸í„° ì˜¤ë¥˜
```
2025-02-06T16:51:47.334+09:00 ERROR 17702 --- [Soo-Shinsa] [nio-8080-exec-5]
org.springframework.dao.InvalidDataAccessApiUsageException: At least 2 parameter(s) provided but only 1 parameter(s) present in query
java.lang.IllegalArgumentException: At least 2 parameter(s) provided but only 1 parameter(s) present in query
```
ì§ì ‘ì ì¸ ì›ì¸ì€ ì°¾ì§€ëŠ” ëª»í–ˆìŠµë‹ˆë‹¤ë§Œ, ìš°íšŒ ë°©ë²•ìœ¼ë¡œ JPQLë¡œ ë³€ê²½í•´ í•´ë‹¹ ì˜¤ë¥˜ë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤. 

- Image
  - S3ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, S3ë§Œ êµ¬ì„±í•œ Componentë¡œ ë§Œë“¤ì–´ì•¼ í•˜ë‚˜, ì•„ë‹ˆë©´, ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³  ì €ì¥í•  ìˆ˜ ìˆëŠ” Image ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ë‚˜ë¼ëŠ” ê³ ë¯¼ì´ ìˆì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ, S3ë¥¼ ì§ì ‘ ì ‘ê·¼í•´ì„œ ì´ë¯¸ì§€ë¥¼ ë“±ë¡ í•˜ê¸° ë³´ë‹¤ëŠ” ì´ë¥¼ ë”°ë¡œ ì„œë¹„ìŠ¤í™”í•´, ìœ ì§€ ë³´ìˆ˜ í•˜ëŠ”ë° ì í•©í•˜ê²Œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ë§ë‹¤ê³  íŒë‹¨ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.
  - image entityì— Image ìƒì„±ìì— originName.split í•´ì„œ ë°°ì—´ ì¸ë±ìŠ¤ ë°”ë¡œ ì ‘ê·¼í•˜ëŠ”ë° í™•ì¥ì ì—†ìœ¼ë©´ OutOfIndex ì˜¤ë¥˜ ë°œìƒ
```
public enum FileType {
    JPG("jpg", "image/jpeg"),
    PNG("png", "image/png"),
    GIF("gif", "image/gif"),
    JPEG("jpeg", "image/jpeg");

    private final String extension;
    private final String mimeType;

    FileType(String extension, String mimeType) {
        this.extension = extension;
        this.mimeType = mimeType;
    }


    /**
     * í™•ì¥ìì™€ MIME íƒ€ì…ì˜ ìœ íš¨ì„±ì„ ê²€ì¦
     * @param extension íŒŒì¼ í™•ì¥ì
     * @param mimeType MIME íƒ€ì…
     * @return ìœ íš¨í•œ ê²½ìš° true
     */
    public static boolean isValid(String extension, String mimeType) {
        return Arrays.stream(values())
                .anyMatch(fileType -> fileType.extension.equals(extension) && fileType.mimeType.equals(mimeType));
    }
}
```
í™•ì¥ì ëª…ì„ ìƒì„±í–ˆê³ , 

```
public class FileUtils {

    /**
     * íŒŒì¼ ì´ë¦„ì—ì„œ í™•ì¥ìë¥¼ ì¶”ì¶œ
     *
     * @param originName ì›ë³¸ íŒŒì¼ëª…
     * @return í™•ì¥ì (ì†Œë¬¸ì)
     * @throws IllegalArgumentException
     */
    public static String extractFileExtension(String originName) {
        int dotIndex = originName.lastIndexOf(".");
        if (dotIndex == -1 || dotIndex == originName.length() - 1) {
            throw new InvalidInputException(NO_EXTENSION);
        }
        return originName.substring(dotIndex + 1).toLowerCase();
    }

    /**
     * íŒŒì¼ ì´ë¦„ì—ì„œ í™•ì¥ìë¥¼ ì œì™¸í•œ ì´ë¦„ë§Œ ì¶”ì¶œ
     *
     * @param originName ì›ë³¸ íŒŒì¼ëª…
     * @return í™•ì¥ìë¥¼ ì œì™¸í•œ íŒŒì¼ëª…
     */
    public static String extractFileName(String originName) {
        int dotIndex = originName.lastIndexOf(".");
        if (dotIndex == -1) {
            return originName; // í™•ì¥ìê°€ ì—†ëŠ” ê²½ìš° ì „ì²´ íŒŒì¼ëª… ë°˜í™˜
        }
        return originName.substring(0, dotIndex); // í™•ì¥ì ì´ì „ì˜ íŒŒì¼ëª… ë°˜í™˜
    }
}
public class FileUtils {

    /**
     * íŒŒì¼ ì´ë¦„ì—ì„œ í™•ì¥ìë¥¼ ì¶”ì¶œ
     *
     * @param originName ì›ë³¸ íŒŒì¼ëª…
     * @return í™•ì¥ì (ì†Œë¬¸ì)
     * @throws IllegalArgumentException
     */
    public static String extractFileExtension(String originName) {
        int dotIndex = originName.lastIndexOf(".");
        if (dotIndex == -1 || dotIndex == originName.length() - 1) {
            throw new InvalidInputException(NO_EXTENSION);
        }
        return originName.substring(dotIndex + 1).toLowerCase();
    }

    /**
     * íŒŒì¼ ì´ë¦„ì—ì„œ í™•ì¥ìë¥¼ ì œì™¸í•œ ì´ë¦„ë§Œ ì¶”ì¶œ
     *
     * @param originName ì›ë³¸ íŒŒì¼ëª…
     * @return í™•ì¥ìë¥¼ ì œì™¸í•œ íŒŒì¼ëª…
     */
    public static String extractFileName(String originName) {
        int dotIndex = originName.lastIndexOf(".");
        if (dotIndex == -1) {
            return originName; // í™•ì¥ìê°€ ì—†ëŠ” ê²½ìš° ì „ì²´ íŒŒì¼ëª… ë°˜í™˜
        }
        return originName.substring(0, dotIndex); // í™•ì¥ì ì´ì „ì˜ íŒŒì¼ëª… ë°˜í™˜
    }
}

```
íŒŒì¼ ìœ í‹¸ì„ í†µí•´ í•´ë‹¹ í™•ì¥ìê°’ì´ ì•„ë‹ˆë©´ ì˜¤ë¥˜ ì²˜ë¦¬ë¥¼ ë”°ë¡œ í–ˆìŠµë‹ˆë‹¤. 
ê·¸í›„ 
```
    public Image(String originName, TargetType targetType) {
        // ì•ˆì „í•œ í™•ì¥ì ì¶”ì¶œ
        this.originName = FileUtils.extractFileName(Objects.requireNonNull(originName, "íŒŒì¼ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤."));
        this.extension = FileUtils.extractFileExtension(originName);

        // ì €ì¥ íŒŒì¼ëª…ì€ UUIDë¡œ ìƒì„±
        this.name = UUID.randomUUID().toString();
        this.path = determinePath(targetType);
    }

```
ì—”í‹°í‹° ìƒì„±ì ë¶€ë¶„ì— í•´ë‹¹ FileUtilì„ ì¶”ê°€í•´ ì •í•´ì§„ í™•ì¥ìê°€ ì•„ë‹ˆë©´ ì´ë¯¸ì§€ ìƒì„±ì‹œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë„ë¡ ì§„í–‰í–ˆìŠµë‹ˆë‹¤. 

- Category
  - ê³„ì¸µí˜• ë°ì´í„° ìƒì„± ë¬¸ì œ
  - ì›ì¸ : ìì‹ ì¹´í…Œê³ ë¦¬ ìƒì„±ì‹œ ë¶€ëª¨ì˜ idê°€ nullë¡œ ìƒì„± ë˜ëŠ” ë¬¸ì œ ë°œìƒ
  - ë°©ì•ˆ : ë¶€ëª¨ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ responseDtoë¥¼ ë‹¤ì‹œ í•œë²ˆ í˜¸ì¶œí•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤
  - í•´ê²° ë°©ë²•
    ```
    this.parent = (category.getParent() != null) ? new CategoryResponseDto(category.getParent()) : null;
     public static CategoryResponseDto toDto(Category category) {
        return new CategoryResponseDto(category);
        }
    }
    ```
    ìì‹ ì¹´í…Œê³ ë¦¬ì˜ ê²½ìš° ì¬ê·€ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ ë¶€ëª¨ì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê²Œ í•¨
- Docker
  - ì§€ê¸ˆ ë°°í¬ëŠ” AWSì—ì„œ demonì„ í˜•ì„±í•´ ì§ì ‘ ë°°í¬í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.
    ê·¸ë˜ì„œ ì´ë¥¼ Containerí™” í•˜ê³ , gitActionsì„ í†µí•´ ìë™í™” ë°°í¬ë¥¼ êµ¬ì„±í•˜ë ¤ê³  í–ˆì§€ë§Œ,
    ```
    Error starting ApplicationContext. To display the condition evaluation report re-run your application with       'debug' enabled.
    2025-02-07T22:49:41.810+09:00 ERROR 35517 --- [Soo-Shinsa] [           main] o.s.boot.SpringApplication               : Application run failed
    org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'cartItemController' defined in file [/Users/hwangsang-ik/IdeaProjects/sparta/soo-shinsa/build/classes/java/main/com/Soo_Shinsa/cartitem/controller/CartItemController.class]: Unsatisfied dependency expressed through constructor parameter 0: Error creating bean with name 'cartItemServiceImpl' defined in file [/Users/hwangsang-ik/IdeaProjects/sparta/soo-shinsa/build/classes/java/main/com/Soo_Shinsa/cartitem/service/CartItemServiceImpl.class]: Unsatisfied dependency expressed through constructor parameter 6: Error creating bean with name 'redissonClient' defined in class path resource [com/Soo_Shinsa/config/RedissonConfig.class]: Failed to instantiate [org.redisson.api.RedissonClient]: Factory method 'redissonClient' threw exception with message:
    ```
    ì´ë¼ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Redis portì—ì„œ ë¬¸ì œê°€ ìƒê²¼ë‹¤ëŠ” ê²ƒì¸ë°, ì•„ì§ Redisê°€ ìµìˆ™í•˜ì§€ ì•Šì•„ ì´ë¥¼ ì§ì ‘ì ìœ¼ë¡œ í•´ê²°í•˜ì§€ëŠ” ëª»í–ˆê³ , ì¶”í›„ dockerì™€ redisë¥¼ ê³µë¶€ í•œ í›„ ì ìš©í•´ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

- Order
    - ì¼ë‹¨ secretKeyë¥¼ Base64.getEncoder() ì¸ì½”ë”©í•´ì„œ restTemplateë¡œ orderIdì™€ amountë¥¼https://api.tosspayments.com/v1/payments/confirm ì— ì „ë‹¬í•´ì¤˜ì•¼ í–ˆëŠ”ë° HTTP ìš”ì²­ì„ ë³´ë‚´ê³  ì‘ë‹µì„ ë°›ëŠ” ê±¸ í•´ë³¸ì ì´ ì—†ì—ˆê³  ë˜í•œ í† ìŠ¤í˜ì´ë¨¼ì¸  ì™¸ë¶€ apiì˜ ê²°ì œ íë¦„ì„ íŒŒì•…í•´ì•¼í–ˆë‹¤. ì¼ë‹¨ HTTPìš”ì²­ì„ ë³´ë‚´ê³  ì‘ë‹µì„ ì–´ë–»ê²Œ í•´ì•¼í• ì§€ ëª°ë¼ ë§ì´ ì–´ë ¤ì› ìŒ. êµ¬ê¸€ë§ ëì— HTTPìš”ì²­ê³¼ í† ìŠ¤í˜ì´ë¨¼ì¸ ì˜ ê°œë°œìì„¼í„°ì—ì„œ apiíë¦„ì„ ê³µë¶€í•˜ê³  ì—ì„œ apië¥¼ ë‹¤ìš´ë°›ê³  ê²°ì œë¥¼ ì™„ë£Œí•˜ë©´ paymentKey ê°’ì´ ë‚˜ì˜¤ëŠ”ë° ì´ê²ƒì„ ê²°ì œê°€ ëë‚  ë•Œ dbì— ì €ì¥í•˜ê³  ì·¨ì†Œê¸°ëŠ¥ì„ ë§Œë“¤ ë•Œ paymentKeyê°’ì„ ì´ìš©í•´ì„œ ê°’ì„ ì°¾ì€ í›„ ì·¨ì†Œ ê²°ì œ ê¸°ëŠ¥ê¹Œì§€ ë‹¤í–‰íˆ êµ¬í˜„. 
```
@Transactional
public void approvePayment(String paymentKey, String orderId, Long amount, Model model) throws JsonProcessingException {
HttpHeaders headers = new HttpHeaders();
headers.set("Authorization", "Basic " + Base64.getEncoder().encodeToString((secretKey + ":").getBytes()));
headers.setContentType(MediaType.APPLICATION_JSON);

Payment findPayment = paymentRepository.findByOrderId(orderId);
findPayment.update(TossPayStatus.DONE, paymentKey);
paymentRepository.save(findPayment);

PayloadRequestDto payload = new PayloadRequestDto(orderId, String.valueOf(amount));
HttpEntity<String> request = new HttpEntity<>(objectMapper.writeValueAsString(payload), headers);
ResponseEntity<JsonNode> responseEntity = restTemplate.postForEntity(
        "https://api.tosspayments.com/v1/payments/" + paymentKey, request, JsonNode.class);
Orders findOrder = ordersRepository.findByOrderId(orderId);
findOrder.updateStatus(PAYMENTCOMPLETED);
ordersRepository.save(findOrder);
```
  - ì£¼ë¬¸ì‹œ ì¿ í° ì ìš©í›„ í• ì¸ ê¸ˆì•¡ì´ totalAmountì— ë“¤ì–´ê°€ì§€ ì•ŠëŠ” ìƒí™©
    ```
        // ì´ ê²°ì œ ê¸ˆì•¡ ê³„ì‚°
    public void calculateTotalPrice() {
        this.totalPrice = orderItems.stream()
                .map(item -> {
                    BigDecimal effectivePrice = (item.getDiscountPrice() != null && item.getDiscountPrice().compareTo(BigDecimal.ZERO) > 0)
                            ? item.getDiscountPrice()
                            : item.getProduct().getPrice();
                    return effectivePrice.multiply(BigDecimal.valueOf(item.getQuantity()));
                })
                .reduce(BigDecimal.ZERO, BigDecimal::add);
    }
    ```
    ê³„ì‚° ë¡œì§ì— DiscountPriceê°€ ì ìš©ë˜ì§€ ì•Šì•˜ì—ˆê³ , OrderItemsì— discountPrice í•„ë“œê°€ ì ìš©ë˜ì§€ ì•Šì•˜ì—ˆë‹¤.
    ê·¸ë˜ì„œ ì¹´íŠ¸ ì•„ì´í…œì—ì„œ ì¿ í°ì„ ì ìš©í•˜ë”ë¼ë„, ì´ ê¸ˆì•¡ì— í• ì¸ ìœ¨ì´ ì ìš©ì´ ë˜ì§€ ì•Šì•˜ìŒ. ê·¸ë˜ì„œ í•´ë‹¹ ì½”ë“œë¥¼ ìœ„ì™€ ê°™ì´ ë³€ê²½ í›„
    í• ì¸ ê¸ˆì•¡ì´ ì ìš© ë˜ì—ˆìŒ. 

## ğŸ«  MVP2ì—ì„œ í•´ì•¼ í•  ê²ƒë“¤ 
1. Token í˜•ì„±ì‹œ RefreshTokenê³¼ BlakcListì— ëŒ€í•œ í•´ë‹¹ ê¸°ëŠ¥ ë“¤ì´ ì—†ë‹¤. ë¡œê·¸ì•„ì›ƒ ì‹œ í•´ë‹¹ í† í°ì„ ì‚­ì œí•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ë”°ë¡œ ê´€ë¦¬ í•´ì¤„ í•„ìš”ê°€ ìˆë‹¤. 
ê·¸ë˜ì„œ ì´ë¥¼ ì¶”í›„ì— ì¶”ê°€í•´ ê´€ë¦¬ í•  ì˜ˆì •
2. ì¿ í°ì„ ë³´ë©´ í˜„ì¬ëŠ” ë¸Œëœë“œë§Œ ì ìš© í•  ìˆ˜ ìˆë„ë¡ ë˜ì–´ ìˆë‹¤. ìƒí’ˆì—ë„ ì ìš© í•  ìˆ˜ ìˆë„ë¡ ìƒí’ˆê³¼ ì¿ í°ì„ ì •ê·œí™”ë¥¼ ì§„í–‰í•˜ê³ , ì ìš©í•  ì˜ˆì •ì´ë‹¤.
3. ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ depthê°€ ë„ˆë¬´ ì–•ë‹¤. ê·¸ë˜ì„œ depthë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ì ìš©í•  ì˜ˆì •
4. ë¸Œëœë“œì— ëŒ€í•œ ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ìƒì„±í•„ìš”
5. docker ìƒì„±ê³¼ git actionsì„ í†µí•œ ìë™í™” ë°°í¬ ì§„í–‰ ì˜ˆì •
